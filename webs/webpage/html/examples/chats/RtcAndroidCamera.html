<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Transitions - jQuery Mobile Demos</title>
    <link rel="stylesheet" href="/aMvc/lib/bootstrap/bootstrap-4.6.1-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/aMvc/lib/css/font-awesome.min.css">
    <link rel="stylesheet" href="/aMvc/lib/summernote-0.8.18-dist/summernote-lite.min.css">
    <link rel="stylesheet" href="/aMvc/lib/css/da-style.css?s=31">

    <script src="/aMvc/lib/jquery/jquery-2.1.2.min.js"></script>
    <script src="/aMvc/lib/jquery/jquery-ui.min.js"></script>
    <script src="/aMvc/lib/bootstrap/bootstrap-4.6.1-dist/js/bootstrap.bundle.min.js"></script>
    <script src="/aMvc/lib/bootstrap/bootstrap-4.6.1-dist/js/bootstrap.min.js"></script>
    <script src="/aMvc/lib/summernote-0.8.18-dist/summernote-lite.min.js"></script>

    <script src="/aMvc/lib/js/da-globallib.js?"></script>

    <script src="/aMvc/base/boardAjaxBase.js?3"></script>
    <script src="/aMvc/base/viewLibBase.js?91"></script>
    <script src="/aMvc/base/templateBase.js?35"></script>

    <script src="/aMvc/lib/qrcode/qrcode.min.js"></script>
    <script src="/aMvc/lib/qrcode/html5-qrcode.min.js"></script>

    <script type="text/javascript">
        var _serverip, _serverlocalip, _myip, _uuid;
        var socket = null, _socket_first_msg = null;

        function isMobileDevice() {
            var user = navigator.userAgent;
            var is_mobile = false;
            if (user.indexOf("Android_Mobile_Moduda") > -1) {
                is_mobile = true;
            }
            return is_mobile;
        }

        function onBtnClick(e) {
            var id = e.id;
            if (id == 'close') {
                signaling.closeMsg();
            } else if (id == 'offer') {
                signaling.rtcOffer();
                console.log("keyCon=======" + keyCon);
            }

        }


        $(document).ready(function () {

            var url = unescape(location.href);
            var pm = url.split('?');
            if (pm && pm[1]) {
                var params = pm[1].split('&');
                for (var i = 0; i < params.length; i++) {
                    var param = params[i].split('=');
                    if (param && param[1]) {
                        if (param[0] == "serverip")
                            _serverip = param[1];
                    }
                }
            }

            if (_serverip) {
                if (url.indexOf('localhost') != -1) {
                    signaling = new RtcAdminRoom({ serverip: _serverip });
                    signaling.renderController(document.body);
                    return;
                }
            }

            console.log('url == ', url);
            fetch('/getip.utils?type=pubkey')
                .then((response) => response.text())
                .then(data => {
                    var xmlDoc = $.parseXML(data);
                    $(xmlDoc).find('Records').each(function (index) {

                        _serverip = $(this).find('serverip').text();
                        _myip = $(this).find('yourip').text();

                        console.log('_myip=' + _myip);
                        console.log('_serverip=' + _serverip);
                        if (url.indexOf('localhost') == -1) {
                            console.log('localhost move');
                            if (isMobileDevice()) {
                                location.href = 'http://localhost:7777/html/examples/chats/RtcAndroidCamera.html?serverip=' + _serverip;
                                return;
                            }

                        } else {

                        }

                        signaling = new RtcAdminRoom({ serverip: null });
                        signaling.renderController(document.body);
                    });
                })// 에러처리
                .catch(() => {
                    console.log('에러')
                });
            
        });
    </script>

</head>
<body class="container" id="a">
    
</body>
</html>
